"use strict";(self.webpackChunkcheckout_web=self.webpackChunkcheckout_web||[]).push([[8217],{68217:(e,t,n)=>{n.r(t),n.d(t,{default:()=>fe});var o=n(62),r=n(24100),i=n(73661),a=n(6306),s=n(81360),c=n(16083),d=n(66126),u=n(50966),l=n(10430),h=n(97185),p=n(4966),m=n(98902),f=n(90208),v=n(49777),g=n(35679),y=n(21302),w=n(55960),k=n(5604),_=n(53798),E=n(59790),S=n(93800),L=n(15515),P=n(92972),C=n.n(P),N=n(77592),b=n(69476),$=n(61027),A=n(75677),T=n(18380),x=n(20134);const V=10;const M={Popper:"qdHCv"};function I({children:e,offset:t,arrowOffset:n,contentWidth:r,contentHeight:i,placement:a="inlineEnd",activator:s,open:c}){const d=function(e){const[t,n]=(0,o.J0)(null),r=(0,o.hb)((()=>{null!==e&&n(e.getBoundingClientRect())}),[e]);return(0,o.Nf)((()=>(r(),window.addEventListener("resize",r),window.addEventListener("scroll",r),()=>{window.removeEventListener("resize",r),window.removeEventListener("scroll",r)})),[r]),t}(s??null),[u,l]=function(){const[e,t]=(0,o.J0)(null);return[e,(0,o.hb)((e=>{null!==e&&t(e.getBoundingClientRect())}),[])]}(),{offsets:h,spacing:p}=(0,o.Kr)((()=>c?function(e,t,n,o,{offset:r=0,arrowOffset:i=0}={}){let a={x:0,y:0},s={left:0,right:0},c=0;if(!t&&!n)return{offsets:a,spacing:c};if(!o){const{clientWidth:e,clientHeight:o}=document.documentElement;return a={x:e/2-t/2,y:o/2-n/2},{offsets:a,spacing:c}}switch(e){case"blockEnd":a={x:"rtl"===(document?.dir??"ltr")?o.left:o.right-t,y:o.bottom+r};break;case"inlineEnd":a={x:"rtl"===(document?.dir??"ltr")?o.left-t-r:o.right+r,y:o.top+o.height/2-i}}return s=function(e,t){const n=document.documentElement.clientWidth,o=e.x+t;let r={left:0,right:0};return o>n&&(r={...r,right:n-o}),e.x<0&&(r={...r,left:-e.x}),r}(a,t),s.right&&!s.left?(a.x+=s.right,c=-V):!s.right&&s.left&&(a.x=0,c=V),{offsets:a,spacing:c}}(a,(r||u?.width)??0,(i||u?.height)??0,d,{offset:t,arrowOffset:n}):{offsets:{x:0,y:0},spacing:0}),[t,n,a,u,d,c,r,i]),{x:m,y:f}=(0,o.Kr)((()=>c?function({x:e,y:t}){const n=window.devicePixelRatio||1;return{x:Math.round(e*n)/n||0,y:Math.round(t*n)/n||0}}({x:h.x+p+(window.scrollX||window.pageXOffset),y:h.y+(window.scrollY||window.pageYOffset)}):{x:0,y:0}),[h,p,c]),v=(0,o.Kr)((()=>c?(window.devicePixelRatio||1)<2?`translate(${m}px, ${f}px)`:`translate3d(${m}px, ${f}px, 0)`:"none"),[c,m,f]);return o.Ay.createElement(x.Z,null,o.Ay.createElement("div",{className:M.Popper,style:{...u&&{transform:v,MozTransform:v,WebkitTransform:v}},ref:l,"aria-hidden":!c},e))}const J={Backdrop:"hgqpU","Backdrop-visible":"LTbS5",BackdropLinearGradient:"axmya",Popover:"JHj7j",Content:"hQvGd",PopoverArrow:"PMbsk",PopoverOpen:"wA8HY","Popover-placementInlineEnd":"trTaz","Popover-placementBlockEnd":"KMvI7",Bumper:"xnzQ4"},B=(0,b.W)("Popover");function K({children:e,activator:t,open:n,placement:r="inlineEnd",contentWidth:i,contentHeight:a,onClose:s}){const c=(0,o.li)(null),d=(0,o.li)(null),u=(0,o.li)(null),l=(0,A.B)(void 0,B),h=(0,T.ts)(),p=(0,o.hb)((()=>{"BUTTON"===t?.tagName&&(t?.setAttribute("aria-controls",l),t?.setAttribute("aria-expanded",String(n)))}),[t,n,l]),m=(0,o.hb)((e=>{s?.(e)}),[s]),f=(0,o.hb)((e=>{e.target instanceof Node&&!t?.contains(e.target)&&document.contains(e.target)&&!u.current?.contains(e.target)&&n&&m(e)}),[m,t,n,u]),v=(0,o.hb)((e=>{if(n)switch(e.key){case"Escape":case"Esc":m(),t?.focus()}}),[m,t,n]);(0,o.vJ)((()=>(document.addEventListener("click",f),()=>{document.removeEventListener("click",f)})),[f]),(0,o.vJ)((()=>(n&&document.addEventListener("keydown",v,!1),()=>{document.removeEventListener("keydown",v,!1)})),[n,v]),(0,o.vJ)((()=>{p()})),(0,o.Nf)((()=>{n&&u.current?.focus({preventScroll:!0})}),[n]);const g=e=>{const t=u.current;if(t){const n=e?(0,$.ag)(t):(0,$.KB)(t);n?n.focus():t.focus()}},y=C()(J.Popover,J[(0,N.N)("Popover-placement",r)],n&&J.PopoverOpen,t&&J.PopoverArrow);return o.Ay.createElement(o.Ay.Fragment,null,o.Ay.createElement(I,{activator:t,placement:r,offset:15,arrowOffset:30,open:n,contentWidth:i,contentHeight:a},n&&o.Ay.createElement("button",{className:J.Bumper,ref:c,"aria-hidden":"true",onFocus:()=>g(!1)}),o.Ay.createElement("div",{className:y,id:l,ref:u},o.Ay.createElement("div",{className:J.Content},e)),n&&o.Ay.createElement("button",{className:J.Bumper,ref:d,"aria-hidden":"true",onFocus:()=>g(!0)})),o.Ay.createElement("div",{className:C()(J.Backdrop,n&&J["Backdrop-visible"],n&&h&&J.BackdropLinearGradient)}))}var O=n(47301),R=n(21031),D=n(98607);var F=n(41356),H=n(61697),W=n(55354),Q=n(43194),z=n(9957),G=n(45691),Z=n(95196),U=n(87295),q=n(929);class j extends Error{constructor(...e){super(...e),this.name="ShopPayError"}}function X({email:e,skipVerifyOnLoad:t,iframeReady:n,iframeRef:r,dismissedModalKey:i,readyToDismiss:s,onReadyToDismiss:c,showPopover:d,showToggle:u,popoverActivator:l}){const h=(0,H.rZ)(),[v]=(0,W.c5)(),{guestDismissedModalKey:g}=(0,Q.N)(),{checkoutSessionIdentifier:w}=(0,m.Fo)(),[,k]=(0,p.fp)(L.h),_=(0,p.QN)(),E=(0,G.QV)(Z.Z.ShopPayVerification,{scope:U.e5}),S=(0,q.fQ)().current.token;return(0,o.vJ)((()=>{if(t.current&&n)return void(t.current=!1);const o=h&&(0,f.Ri)(i),s=e&&(0,a.B9)(e),c="connected"===v.status,d=h&&function(){const e=sessionStorage.getItem(y.eQ);if(!e)return!1;const t=Number.parseInt(e,10);return!isNaN(t)&&Date.now()<t}();!n||!s||o||c||d||(_.read(E).value!==z.Vp.Verified?(0,R.L)(r?.current,{action:D.L$.Create,email:e,flow:F.n.Normal,disableAutoFocus:Boolean(sessionStorage.getItem(g))}):_.write(E,void 0))}),[e,n]),{onShow:function(){if(!w)throw new j("Checkout token is undefined");h&&(0,f.Ri)(i)||e&&(0,a.B9)(e)&&(s||c(),S&&(0,R.L)(r?.current,{action:D.L$.CheckoutQueueToken,queueToken:S}),(0,f.TV)(y.Sl,escape(w)),(0,f.TV)(y.GH,"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set")),_.write(E,z.Vp.Pending),sessionStorage.getItem(g)?u?.(!0):(d(!0,e),u?.(!1)))},onHidden:function(){s&&(_.write(E,z.Vp.Dismissed),h&&(0,f.TV)(i,"true"),l?.current?.focus(),d(!1),u?.(!0))},onLoggedIn:function(){(0,a.NW)(),_.write(E,z.Vp.Verified),k("none")}}}var Y=n(91450),ee=n(34142),te=n(59621),ne=n(45742),oe=n(10052);class re extends Error{constructor(...e){super(...e),this.name="ShopPayError"}}const ie=[D.hD.FraudGuard,D.hD.InvalidPhone,D.hD.LimitExceeded,D.hD.PhoneBlocked];function ae({email:e,onSetEmail:t,skipVerifyOnLoad:n,iframeReady:r,iframeRef:s,readyToDismiss:c,onReadyToDismiss:d,showPopover:u,popoverActivator:l,origin:h,open:f}){const{checkoutSessionIdentifier:v}=(0,m.Fo)(),{openModal:g}=(0,Y.$)(),{exchangeSessionTokenForCookie:y}=(0,ee.H)(),[,w]=(0,p.fp)(L.h),k=(0,o.li)(null),_=(0,o.li)(!1),E=(0,te.oO)(),[,S]=(0,ne.j1)(),P=(0,o.hb)((()=>{s.current&&(0,R.L)(s.current,{action:D.L$.Create,email:"",flow:F.n.Normal})}),[s]);return(0,o.vJ)((()=>{s.current&&r&&h===i.K.C1ModalShopPaySignIn&&((0,R.L)(s.current,{action:D.L$.AllowNoInitialEmail}),P(),(0,R.L)(s.current,{action:D.L$.Ready}))}),[r,s,h,P]),(0,o.vJ)((()=>{f&&(k.current=null)}),[f]),(0,o.vJ)((()=>{_.current&&s.current&&r&&(_.current=!1,P())})),(0,o.vJ)((()=>{function e(){t&&(E.set({email:"",userStatus:te.$_.None}),t(""),l?.current?.focus()),_.current=!0}return window.addEventListener("shop_pay_verification_reset",e),()=>{window.removeEventListener("shop_pay_verification_reset",e)}}),[l,u,t,s,E]),(0,o.vJ)((()=>{r&&(n.current?n.current=!1:e&&(0,a.B9)(e)&&h!==i.K.C1ModalShopPaySignIn?(E.set({email:e,userStatus:te.$_.Loading}),(0,R.L)(s?.current,{action:D.L$.Create,email:e,flow:F.n.Normal})):h!==i.K.C1ModalShopPaySignIn&&(P(),E.set({email:"",userStatus:te.$_.None})))}),[e,r,n,s,h,E,P,u,S]),{onShow:function(){if(!v)throw new re("Checkout token is undefined");h===i.K.C1ModalShopPay&&e&&(0,a.B9)(e)&&(c||d(),E.set({email:e,userStatus:te.$_.Found}),u(!0,e))},onHidden:function(){if(h===i.K.C1ModalShopPay&&!c)return;const n=k.current;null!=t&&null!=n&&(n.userStatus!==te.$_.Found||h===i.K.C1ModalShopPay||!e)&&(t(n.email),E.set(n),l?.current?.focus()),E.get().userStatus===te.$_.Found?g({type:oe.W.ContinueWithShopPay,email:E.get().email}):l?.current?.focus(),u(!1),k.current=null},onEmailChange:function(e,t){e?(k.current||E.get().email!==e)&&(k.current={email:e,userStatus:t?te.$_.Found:te.$_.New}):k.current={email:"",userStatus:te.$_.None}},onError:function(e,t,n){if((!n||n===E.get().email)&&(e===D.Wu.ShopifyPayUserNotFound&&ie.includes(t)&&(u(!1),g({type:oe.W.Generic})),n)){const e=t===D.hD.InvalidEmail;E.set({email:n,userStatus:e?te.$_.Invalid:te.$_.New})}},onLoggedIn:async function(e,t){(0,a.NW)(),w("none"),e&&(await y({token:e,origin:h,in_checkout_profile_preview:t}),window.location.reload())}}}var se=n(94717);function ce({email:e,onSetEmail:t,open:n,popoverActivator:r,showPopover:a,showToggle:s,urlOrigin:c=i.K.C1Modal,updatedOrigin:d=c,onIframeLoaded:P}){const C=(0,l.t)({base:"blockEnd",medium:"inlineEnd"}),[N,b]=(0,o.J0)(!1),[$,A]=(0,o.J0)(300),[T,x]=(0,o.J0)(!1),V=(0,h.W)(),{checkoutSessionIdentifier:M}=(0,m.Fo)(),I=(0,o.li)(null),{alternate:J}=(0,_.af)(),B=J,[F,H]=(0,o.J0)(!1),[,W]=(0,p.fp)(L.h),Q=(0,p.md)(v.D?.flow)===g.p.UnauthenticatedUser,z=(0,k.d7)(e,y.y4),G=`${M}-${e.replace(/[^a-zA-Z0-9]/g,"")}`,Z=(0,w.Q)(),U=(0,o.li)(Z),{onShow:q,onHidden:j,onError:Y,onEmailChange:ee,onLoggedIn:te}=function(e){const t=(0,u.W$)(),n=(0,o.li)(e),r=n.current,i=e===n.current?void 0:`Callback hook changed from ${n.current.name} to ${e.name} between renders.`;return(0,o.vJ)((()=>{i&&t.notify(new se.BS(`${i} Only the original hook is called.`),{severity:"warning",errorClass:"ShopPay::ShopPayVerification::useStableHook"})}),[i,t]),r}(Q?ae:X)({email:z,onSetEmail:t,skipVerifyOnLoad:U,iframeReady:N,iframeRef:I,dismissedModalKey:G,readyToDismiss:T,onReadyToDismiss:()=>{setTimeout((()=>x(!0)),1e3)},showPopover:a,showToggle:s,popoverActivator:r,origin:d,open:n});(0,O.d)({hostname:B,targetId:c,onReady:q,onClosed:function(){H(!0)},onLoggedIn:te,onHidden:j,onError:function(e,t,n){Y?.(e,t,n),e===D.Wu.ShopifyPayUserNotFound&&(0,f.TV)(y.Sl,"false"),(0,f.TV)(y.GH,t===D.hD.LimitExceeded?M||"":"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set"))},onResized:function(e){!isNaN(e)&&e&&A(e)},onLoaded:()=>{b(!0),P()},onEmailChange:ee}),(0,o.vJ)((()=>{(0,R.L)(I?.current,{action:D.L$.OriginChanged,origin:d})}),[d]),(0,o.vJ)((()=>{const e=n?D.L$.Ready:D.L$.Hidden;(0,R.L)(I?.current,{action:e}),W(n?"shopPayVerification":"none"),I.current&&n&&I.current.focus()}),[n,W]);const ne=(0,S.X)(c);if((0,o.vJ)((()=>()=>{b(!1)}),[ne]),!ne)return null;const oe=n?r?.current:void 0;return o.Ay.createElement(K,{activator:oe,open:n,onClose:j,placement:C,contentWidth:320,contentHeight:$},o.Ay.createElement(E.R,{active:F||!N,size:"large"},o.Ay.createElement("iframe",{key:ne,id:"shop-pay-verification-iframe",title:V("shop_pay.verification.title","Shop Pay Quick Checkout"),ref:I,src:ne,height:$,width:320,className:"B1y2m",allow:"publickey-credentials-get *",referrerPolicy:"origin"})))}var de=n(63147),ue=n(31191),le=n(84031);const he=({shopCheckoutModal:e,eventName:t,eventListener:n})=>{(0,o.vJ)((()=>(e?.addEventListener(t,n),()=>e?.removeEventListener(t,n))),[n,t,e])};function pe({email:e,open:t,popoverActivator:n,showPopover:r,showToggle:i,onIframeLoaded:s}){const c=n?.current,d=(0,o.li)(null),[u,l]=(0,o.J0)(!1),h=(0,o.li)(!1),{redirect_url:v,transaction_params:g}=(0,le.I)(),{myshopifyDomain:k}=(0,ue.qu)(),_=(0,H.rZ)(),[E]=(0,W.c5)(),{guestDismissedModalKey:S}=(0,Q.N)(),{checkoutSessionIdentifier:P}=(0,m.Fo)(),C=(0,q.fQ)().current.token,[,N]=(0,p.fp)(L.h);(0,o.vJ)((()=>{customElements.get("shop-checkout-modal")||(0,de.r)()}),[]);const b=(0,p.QN)(),$=(0,G.QV)(Z.Z.ShopPayVerification,{scope:U.e5}),A=`${P}-${e.replace(/[^a-zA-Z0-9]/g,"")}`,T=(0,w.Q)(),x=(0,o.li)(T);(0,o.vJ)((()=>{if(x.current)return x.current=!1,void l(!1);const e=sessionStorage.getItem(S),t=_&&(0,f.Ri)(A),n="connected"===E.status;if(!(e||t||n))return b.read($).value===z.Vp.Verified?(b.write($,void 0),void l(!1)):void l(!0);l(!1)}),[e]);const V=(0,o.hb)((()=>{(0,a.NW)(),b.write($,z.Vp.Verified),N("none")}),[N,$,b]);he({shopCheckoutModal:d.current,eventName:"completed",eventListener:V});const M=(0,o.hb)((()=>{if(!P)throw new se.BS("Checkout token is undefined");(0,f.TV)(y.Sl,escape(P)),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set")),b.write($,z.Vp.Pending),r?.(!0,e),i?.(!1)}),[P,e,$,r,i,b]);he({shopCheckoutModal:d.current,eventName:"modalopened",eventListener:M});const I=(0,o.hb)((()=>{b.write($,z.Vp.Dismissed),_&&(0,f.TV)(A,"true"),r?.(!1),i?.(h.current)}),[_,A,$,r,i,b]);he({shopCheckoutModal:d.current,eventName:"modalclosed",eventListener:I});const J=(0,o.hb)((()=>{h.current=!0}),[]);he({shopCheckoutModal:d.current,eventName:"shopusermatched",eventListener:J});const B=(0,o.hb)((e=>{h.current=!1,(0,f.TV)(y.Sl,"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set"))}),[]);return he({shopCheckoutModal:d.current,eventName:"shopusernotmatched",eventListener:B}),he({shopCheckoutModal:d.current,eventName:"loaded",eventListener:s}),(0,o.vJ)((()=>{const e=d.current;N(t?"shopPayVerification":"none"),c&&t&&(e?.open(),c.blur())}),[c,e,t,N]),o.Ay.createElement("shop-checkout-modal",{"anchor-to":c?.id?`#${c.id}`:"","checkout-redirect-url":v,"checkout-token":P,"checkout-version":"checkout_one",email:t||u?e:"","queue-token":C||"",ref:d,"shop-permanent-domain":k,"transaction-params":g})}const me=e=>{const t=o.FK;return o.Ay.createElement(t,null,o.Ay.createElement(pe,e))},fe=({email:e,onSetEmail:t,open:n,popoverActivator:l,showPopover:h,showToggle:p,urlOrigin:m=i.K.C1Modal,updatedOrigin:f=i.K.C1Modal})=>{const v=(0,c.a)(d.hZ),g=(0,s.o)(),y=v&&!g,w=(0,u.G6)(),k=(0,o.Kr)((()=>(0,r.S)()),[]),_=(0,o.Kr)((()=>(0,r.S)()),[]),E=(0,o.li)(!0),S=(0,o.Kr)((()=>{if(void 0!==y)return{isC1:!0,shopJsVerification:y}}),[y]);(0,o.vJ)((()=>{(0,a.B9)(e)&&(k.mark("start"),E.current=!0)}),[k,e]),(0,o.vJ)((()=>{if(n&&E.current&&k.marks.start&&S){k.mark("open"),E.current=!1;const e=Math.round(k.marks.open-k.marks.start);w.histogram({name:"shop_pay_verification_time_to_interactive",value:e,attributes:S});const t=Math.round(k.marks.open-Math.max(k.marks.start,k.marks.loaded||0));w.histogram({name:"shop_pay_verification_time_to_interactive_after_load",value:t,attributes:S})}}),[n,w,k,S]),(0,o.vJ)((()=>{_.mark("start")}),[_]);const L=(0,o.hb)((()=>{if(_.marks.start){_.mark("loaded"),k.mark("loaded");const e=Math.round(_.marks.loaded-_.marks.start);w.histogram({name:"shop_pay_verification_iframe_ready_duration",value:e,attributes:S})}}),[_,k,w,S]);return y?o.Ay.createElement(me,{popoverActivator:l,email:e,open:n,showPopover:h,showToggle:p,onIframeLoaded:L}):o.Ay.createElement(ce,{popoverActivator:l,email:e,onSetEmail:t,open:n,showPopover:h,showToggle:p,urlOrigin:m,updatedOrigin:f,onIframeLoaded:L})}},34142:(e,t,n)=>{n.d(t,{H:()=>c});var o=n(62),r=n(53798),i=n(31191),a=n(98902),s=n(28178);const c=()=>{const{myshopifyDomain:e}=(0,i.qu)(),{checkoutSessionIdentifier:t}=(0,a.Fo)(),n=(0,s.j9)();return{exchangeSessionTokenForCookie:(0,o.hb)((async({token:o,origin:i,analytics_trace_id:a,in_checkout_profile_preview:s})=>{const{primary:c}=(0,r.af)(),d=new URLSearchParams({token:o,origin:i,shopify_domain:e});t&&d.set("checkout_token",t),a&&d.set("analytics_trace_id",a),s&&d.set("in_checkout_profile_preview",s),await fetch(`https://${c}${n.shopPaySession()}?${d.toString()}`,{method:"POST",keepalive:!0})}),[t,e,n])}}}}]);