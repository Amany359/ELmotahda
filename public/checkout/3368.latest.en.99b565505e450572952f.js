"use strict";(self.webpackChunkcheckout_web=self.webpackChunkcheckout_web||[]).push([[3368],{33368:(e,t,n)=>{n.d(t,{c:()=>P}),n(86043);var r=n(12301),a=n(86936),i=n(11240),o=n(8281),s=n(51803),d=n(65939),u=n(10017),c=n(3989),l=n(11947),p=n(17865),m=n(95831),y=n(32246),h=n(89680),g=n(25201);class f extends Error{constructor(...e){super(...e),this.name="ReceiptError"}}function P(e,t={pollingTimeoutReached:!1,skipToThankYouPage:!1,waitingForPostPurchaseDone:!1}){switch(e.__typename){case"ProcessingReceipt":case"WaitingReceipt":return{status:"processing",id:e.id,pollAt:Date.now()+e.pollDelay};case"ProcessedReceipt":{if(e.postPurchasePageRequested&&"NOT_READY"===e.postPurchaseVaultedPaymentMethodStatus&&!t.pollingTimeoutReached)return{status:"polling_for_order",id:e.id,token:e.token};const f={amount:parseFloat(e.purchaseOrder.totalAmountToPay.amount),currencyCode:e.purchaseOrder.totalAmountToPay.currencyCode},_=(0,h.FO)(e.purchaseOrder.note);return{status:"processed",id:e.id,token:e.token,redirectUrl:e.redirectUrl||null,confirmationPage:{url:e.confirmationPage.url,shouldRedirect:e.confirmationPage.shouldRedirect},analytics:{checkoutCompletedEventId:e.analytics?.checkoutCompletedEventId||null},orderIdentity:{buyerIdentifier:e.orderIdentity.buyerIdentifier,id:e.orderIdentity.id},paymentDetails:{paymentCardBrand:e.paymentDetails?.paymentCardBrand,creditCardLastFourDigits:e.paymentDetails?.creditCardLastFourDigits,paymentAmount:e.paymentDetails?.paymentAmount?.amount,paymentCurrency:e.paymentDetails?.paymentAmount?.currencyCode,paymentGateway:e.paymentDetails?.paymentGateway,financialPendingReason:e.paymentDetails?.financialPendingReason,paymentDescriptor:e.paymentDetails?.paymentDescriptor,buyerActionInfo:e.paymentDetails?.buyerActionInfo??void 0},purchaseOrder:{email:A(e.purchaseOrder.buyerIdentity),phone:v(e.purchaseOrder.buyerIdentity),checkoutCompletionTarget:e.purchaseOrder.checkoutCompletionTarget,shippingAddress:b(e.purchaseOrder.delivery),billingAddress:M(e.purchaseOrder.payment),paymentLines:(P=e.purchaseOrder.payment,P.paymentLines.filter((e=>!e.dueAt)).sort(I).map((e=>({...D(e.paymentMethod),cost:T(e.amount),specialInstructions:e.postPaymentMessage??void 0})))),deliveryNext:C(e.purchaseOrder.delivery,_),deliveryExpectations:(o=e.purchaseOrder.deliveryExpectations,o?{status:"filled",deliveryExpectationLines:o.map((e=>({deliveryOptionHandle:void 0,deliveryStrategyHandle:e.deliveryStrategyHandle,brandedPromise:e.brandedPromise?{name:e.brandedPromise.name,logoUrl:e.brandedPromise.logoUrl,handle:e.brandedPromise.handle,darkThemeLogoUrl:e.brandedPromise.darkThemeLogoUrl,lightThemeLogoUrl:e.brandedPromise.lightThemeLogoUrl}:void 0,minDeliveryDateTime:void 0,maxDeliveryDateTime:void 0,deliveryExpectationPresentmentTitle:e.deliveryExpectationPresentmentTitle,promiseProviderApiClientId:void 0,returnability:e.returnability?.returnable})))}:{status:"unavailable",deliveryExpectationLines:null}),paymentDue:(0,r.OR)(e.purchaseOrder.payment,f),runningTotal:f,merchandiseLines:w(e.purchaseOrder.merchandise),totalTaxes:e.purchaseOrder.tax.totalTaxAmountV2?T(e.purchaseOrder.tax.totalTaxAmountV2):void 0,metafields:e.purchaseOrder.metafields},purchaseOrderNumber:e.poNumber??void 0,orderCreationStatus:(i=e.orderCreationStatus,"OrderCreationSucceeded"===i.__typename?{status:"created"}:{status:"processing"}),postPurchasePageUrl:e.postPurchasePageUrl,postPurchaseVaultingStatus:R(e.postPurchaseVaultedPaymentMethodStatus),postPurchasePageRequested:e.postPurchasePageRequested,shopPayArtifact:{optIn:e.purchaseOrder.shopPayArtifact?.optIn??void 0},shopAppLinksAndResources:{qrCodeUrl:e.shopAppLinksAndResources.qrCodeUrl,mobileUrl:e.shopAppLinksAndResources.mobileUrl,canTrackOrderUpdates:e.shopAppLinksAndResources.canTrackOrderUpdates,shopInstallmentsViewSchedules:e.shopAppLinksAndResources.shopInstallmentsViewSchedules,installmentsHighlightEligible:e.shopAppLinksAndResources.installmentsHighlightEligible,shopInstallmentsMobileUrl:e.shopAppLinksAndResources.shopInstallmentsMobileUrl,mobileUrlAttributionPayload:e.shopAppLinksAndResources.mobileUrlAttributionPayload,shopAppEligible:e.shopAppLinksAndResources.shopAppEligible,shopAppQrCodeKillswitch:e.shopAppLinksAndResources.shopAppQrCodeKillswitch,shopPayOrder:e.shopAppLinksAndResources.shopPayOrder,buyerHasShopApp:e.shopAppLinksAndResources?.buyerHasShopApp??void 0,buyerHasShopPay:e.shopAppLinksAndResources?.buyerHasShopPay??void 0,orderUpdateOptions:e.shopAppLinksAndResources.orderUpdateOptions},skipToThankYouPage:Boolean(t.skipToThankYouPage),waitingForPostPurchaseDone:!1,eligibleForMarketingOptIn:e.eligibleForMarketingOptIn,recurringTotals:(0,d.u)(e.purchaseOrder.recurringTotals),deferredTotal:(0,u.HV)(e.purchaseOrder.deferredTotal??void 0),checkoutTotalBeforeTaxesAndShipping:e.purchaseOrder.checkoutTotalBeforeTaxesAndShipping?(0,s.ox)(e.purchaseOrder.checkoutTotalBeforeTaxesAndShipping):void 0,checkoutTotal:(0,s.ox)(e.purchaseOrder.checkoutTotal),checkoutTotalTaxes:e.purchaseOrder.checkoutTotalTaxes?(0,s.ox)(e.purchaseOrder.checkoutTotalTaxes):void 0,taxes:(0,p.Xw)({...e.purchaseOrder.tax,totalTaxAmount:e.purchaseOrder.tax.totalTaxAmountV2??void 0}),legacyRepresentProductsAsFees:e.purchaseOrder.legacyRepresentProductsAsFees,totalSavings:(0,s.ox)(e.purchaseOrder.totalSavings),subtotal:(0,s.ox)(e.purchaseOrder.subtotalBeforeTaxesAndShipping),landedCostDetails:e.purchaseOrder.landedCostDetails?.incotermInformation??void 0,dutiesIncluded:e.purchaseOrder.dutiesIncluded??void 0,duties:(a=e.purchaseOrder.tax.totalDutyAmount,a?{status:"available_total",totalDuty:(0,s.ox)(a)}:{status:"unavailable",reason:""}),paymentFlexibilityPaymentTermsTemplate:e.paymentFlexibilityPaymentTermsTemplate??void 0,optionalDuties:e.purchaseOrder.optionalDuties?(0,m.S)(e.purchaseOrder.optionalDuties):void 0,discountLines:(n=e.purchaseOrder.discounts,{lines:n.lines.map(U).filter((e=>Boolean(e)))}),tipLines:(y=e.purchaseOrder.tip,y.tipLines.map((e=>({amount:(0,s.ox)(e.amount)})))),hasOnlyDeferredShipping:e.purchaseOrder.hasOnlyDeferredShipping,acceptMarketing:(c=e.purchaseOrder.buyerIdentity,q(c)),acceptEmailMarketing:q(e.purchaseOrder.buyerIdentity),acceptSmsMarketing:N(e.purchaseOrder.buyerIdentity),smsMarketingPhone:G(e.purchaseOrder.buyerIdentity),note:e.purchaseOrder.note.message??void 0,paymentMethods:V(e.purchaseOrder.payment.paymentLines),customerId:e.customerId??void 0,buyerIdentity:e.purchaseOrder.buyerIdentity?(0,g.xv)(e.purchaseOrder.buyerIdentity):void 0,subtotalBeforeReductions:(0,s.ox)(e.purchaseOrder.subtotalBeforeReductions),customAttributes:e.purchaseOrder.note?.customAttributes??void 0,legacySubtotalBeforeTaxesShippingAndFees:(0,s.ox)(e.purchaseOrder.legacySubtotalBeforeTaxesShippingAndFees),legacyMerchandiseLinesAsFees:(0,l.Y8)(e.purchaseOrder.legacyAggregatedMerchandiseTermsAsFees)}}case"FailedReceipt":return{status:"failed",id:e.id,failure:x(e.processingError)};case"ActionRequiredReceipt":return{status:"action_required",id:e.id,action:S(e.action),timeout:L(e)};default:throw new f(`Unknown receipt type: ${e.__typename}`)}var n,a,i,o,c,y,P}function A(e){const{contactMethod:t}=e;return"PurchaseOrderEmailContactMethod"===t.__typename?t.email:void 0}function v(e){const{contactMethod:t}=e;return"PurchaseOrderSMSContactMethod"===t.__typename?t.phoneNumber:void 0}function b(e){const t=e.deliveryLines.find((e=>e.destinationAddress))?.destinationAddress,n="StreetAddress"===t?.__typename?t:void 0;return n?(0,a.G)(n):void 0}function M(e){const t="StreetAddress"===e.billingAddress?.__typename?e.billingAddress:void 0,n=e.paymentLines.find((e=>"WalletPaymentMethod"===e.paymentMethod.__typename));if(n)return function(e,t){if("WalletPaymentMethod"===e?.paymentMethod?.__typename&&""!==e?.paymentMethod?.walletContent.__typename){const n=e?.paymentMethod?.walletContent.billingAddress??t??void 0;return n?(0,a.G)(n):void 0}}(n,t);const r=e.paymentLines.map((e=>e.paymentMethod)).filter((e=>"DirectPaymentMethod"===e.__typename||"LocalPaymentMethod"===e.__typename||"OffsitePaymentMethod"===e.__typename||"ManualPaymentMethod"===e.__typename||"CustomPaymentMethod"===e.__typename||"PaymentOnDeliveryMethod"===e.__typename)),i=r.find((e=>"StreetAddress"===e.billingAddress.__typename))?.billingAddress??t??void 0;return i?(0,a.G)(i):void 0}function _(e){if("PickupInStoreLocation"===e?.__typename||"PickupPointLocation"===e?.__typename){if("PickupPointLocation"===e?.__typename){const{name:t,carrierCode:n,carrierName:r,carrierLogoUrl:i,fromDeliveryOptionGenerator:o,address:s}=e;return{name:t,address:(0,a.G)(s),carrierName:r,carrierCode:n,carrierLogoUrl:i,fromDeliveryOptionGenerator:o,type:e?.__typename}}return{name:e.name,address:(0,a.G)(e.address),instructions:e.instructions,type:e?.__typename}}}function O(e,t){return e.reduce(((e,n)=>{if("PurchaseOrderMerchandiseLine"!==n.__typename&&"PurchaseOrderBundleLineComponent"!==n.__typename)return e;const{stableId:r,merchandise:a,quantity:i}=n;if("ProductVariantSnapshot"===a.__typename){const n="number"==typeof(o=i)?o:"PurchaseOrderMerchandiseQuantityByItem"===o.__typename?o.items:0,s=a.image?{...a.image,altText:a.image.altText||void 0}:void 0;return[...e,{id:a.variantId,digest:a.digest,title:a.productTitle,stableId:r,requiresShipping:!t&&(a.requiresShipping??!0),properties:(0,l.PN)(a.properties),subtitle:a.title??void 0,sellingPlan:(0,y.l)(a.sellingPlan),quantity:n,image:s}]}var o;return e}),[])}function C(e,t){const n=e.deliveryLines.map((e=>function(e,t){const n={handle:e.deliveryStrategy.handle,title:e.deliveryStrategy.title,description:e.deliveryStrategy.description??void 0,cost:(0,s.ox)(e.lineAmount),costAfterDiscounts:(0,s.ox)(e.lineAmountAfterDiscounts),estimatedTimeInTransit:void 0,methodType:e.deliveryStrategy.methodType,brandedPromise:e.deliveryStrategy.brandedPromise,pickupLocation:_(e.deliveryStrategy.pickupLocation),deliveryPromisePresentmentTitle:e.deliveryStrategy.deliveryPromisePresentmentTitle,metafields:[]};return n&&"NONE"!==n.methodType?{status:"available",methods:[n],selectedDeliveryMethodHandle:n.handle,type:e.groupType,targetMerchandiseLines:O(e.targetMerchandise,t)}:{status:"not_required",type:e.groupType,targetMerchandiseLines:O(e.targetMerchandise,t)}}(e,t)));return{status:"filled",lines:n}}function I(e,t){const n="PurchaseOrderGiftCardPaymentMethod"===e.paymentMethod.__typename,r="PurchaseOrderGiftCardPaymentMethod"===t.paymentMethod.__typename;return n&&!r?-1:!n&&r?1:0}function T(e){if(null!=e)return{amount:parseFloat(e.amount),currencyCode:e.currencyCode}}function D(e){switch(e.__typename){case"DirectPaymentMethod":return{method:{type:"direct",sessionId:e.sessionId,paymentMethodIdentifier:e.paymentMethodIdentifier??"",brand:e.creditCard?.brand??void 0,creditCardLastFourDigits:e.creditCard?.lastDigits??void 0,vaultingAgreement:e.vaultingAgreement}};case"CustomerCreditCardPaymentMethod":return{method:{type:o.NK.CreditCard,token:e.token,billingAddress:(0,a.G)(e.billingAddress),brand:e.brand,firstDigits:e.firstDigits??void 0,displayLastDigits:e.displayLastDigits,defaultPaymentMethod:e.defaultPaymentMethod,deletable:e.deletable,requiresCvvConfirmation:e.requiresCvvConfirmation}};case"PaymentOnDeliveryMethod":return{method:{type:"paymentOnDelivery",additionalDetails:e.additionalDetails??"",paymentInstructions:e.paymentInstructions??"",paymentMethodIdentifier:e.paymentMethodIdentifier??"",availablePresentmentCurrencies:[]}};case"PurchaseOrderGiftCardPaymentMethod":return{method:{type:"giftCard",code:e.code,balance:T(e.balance)}};case"WalletPaymentMethod":return{method:{type:"wallet",name:e.name,walletContent:k(e.walletContent)}};case"WalletsPlatformPaymentMethod":return{method:{type:"walletsPlatformPaymentMethod",name:e.name,walletParams:e.walletParams}};case"LocalPaymentMethod":return{method:{type:"local",paymentMethodIdentifier:e.paymentMethodIdentifier??"",name:e.name}};case"DeferredPaymentMethod":return{method:{type:"deferred"}};case"ManualPaymentMethod":return{method:{type:"manualPayment",name:e.name,id:e.id,additionalDetails:e.additionalDetails??"",paymentInstructions:e.paymentInstructions??"",paymentMethodIdentifier:e.paymentMethodIdentifier??"",availablePresentmentCurrencies:[]}};case"CustomPaymentMethod":return{method:{type:"customManualPayment",name:e.name,id:e.id,additionalDetails:e.additionalDetails??"",paymentInstructions:e.paymentInstructions??"",paymentMethodIdentifier:e.paymentMethodIdentifier??"",availablePresentmentCurrencies:[]}};case"PaypalBillingAgreementPaymentMethod":return{method:{type:o.NK.PayPal,token:e.token,billingAddress:(0,a.G)(e.billingAddress)}};case"OffsitePaymentMethod":return{method:{type:"offsite",paymentMethodIdentifier:e.paymentMethodIdentifier??void 0,name:e.name}};case"RedeemablePaymentMethod":return"CUSTOM"===e.redemptionSource?{method:{type:"redeemable",redemptionSource:e.redemptionSource,redemptionContent:e.redemptionContent}}:{method:{type:"redeemable",redemptionSource:e.redemptionSource}};case"CustomOnsitePaymentMethod":return{method:{type:"customOnsite",paymentMethodIdentifier:e.paymentMethodIdentifier??void 0,name:e.name}};default:return{method:{type:"other"}}}}function k(e){switch(e.__typename){case"ShopifyInstallmentsWalletContent":return{autoPayEnabled:e.autoPayEnabled,billingAddress:(0,i.dP)(e.billingAddress),disclosureDetails:e.disclosureDetails,installmentsToken:e.installmentsToken,creditCardBrand:e.creditCard?.brand??void 0,creditCardLastFourDigits:e.creditCard?.lastDigits??void 0};case"ShopPayWalletContent":return{billingAddress:(0,i.dP)(e.billingAddress),paymentMethod:e.paymentMethod,paymentAttributes:e.paymentAttributes,paymentMethodIdentifier:e.paymentMethodIdentifier}}}function x(e){switch(e.__typename){case"InventoryClaimFailure":case"InventoryReservationFailure":return{type:"inventory"};case"PaymentFailed":return{type:"payment",code:e.code,hasOffsitePaymentMethod:e.hasOffsitePaymentMethod};case"DiscountUsageLimitExceededFailure":return{type:"discount"};case"OrderCreationFailure":case"OrderCreationSchedulingFailure":return{type:"order"};case"CustomerPersistenceFailure":return{type:"customer_persistence"};default:return{type:"other"}}}function S(e){if("CompletePaymentChallenge"===e.__typename)return{type:"complete_payment_challenge",offsiteRedirect:e.offsiteRedirect,url:e.url};throw new f(`Unable to handle receipt action: ${e.__typename}`)}function L(e){const t=e.timeout;return t?{millisecondsRemaining:t.millisecondsRemaining}:void 0}function R(e){switch(e){case"READY":return"ready";case"NOT_READY":return"notReady";case"EXPIRED":return"expired";case"DISABLED_FEATURE":return"disabled"}}function w(e){const{taxesIncluded:t,merchandiseLines:n}=e;return{taxesIncluded:t,lines:n.map(E).filter(Boolean)}}function E(e){const{stableId:t,merchandise:n,lineAllocations:r,quantity:a,recurringTotal:i,__typename:o}=e;if("ProductVariantSnapshot"===n.__typename){const u="PurchaseOrderMerchandiseLine"===o?e.lineAmount:e.totalAmount;return{id:n.variantId,deferredAmount:(0,s.ox)(n.deferredAmount),digest:n.digest,giftCard:n.giftCard,image:(0,l.DK)(n.image),itemPrice:(0,s.ox)(n.price),legacyFee:"PurchaseOrderMerchandiseLine"===o&&e.legacyFee,lineAllocations:r.map(F),lineComponents:"PurchaseOrderMerchandiseLine"===o?e.lineComponents.map(E).filter(Boolean):[],options:n.options,productId:n.productId,productType:n.productType,properties:(0,l.PN)(n.properties),quantity:"PurchaseOrderMerchandiseLine"===o?a.items:a,recurringTotal:i?(0,d.z)(i):void 0,requiresShipping:n.requiresShipping,sellingPlan:(0,y.l)(n.sellingPlan),sku:n.sku,stableId:t,subtitle:n.title??void 0,taxCode:n.taxCode,taxable:n.taxable,title:n.productTitle,productUrl:n.productUrl??void 0,untranslatedTitle:n.untranslatedTitle,untranslatedSubtitle:n.untranslatedSubtitle??"",totalPrice:(0,s.ox)(u),typename:n.__typename,variantId:n.variantId,vendor:n.vendor,weight:n.weight}}}function F(e){const{stableId:t,quantity:n,totalAmountAfterDiscounts:r,totalAmountAfterLineDiscounts:a,totalAmountBeforeReductions:i,checkoutPriceAfterDiscounts:o,checkoutPriceBeforeReductions:d,discountAllocations:u,unitPrice:l}=e,p=l?{...l,price:(0,s.ox)(l.price)}:null,m=u.reduce(((e,t)=>{const{discount:n,amount:r}=t,a=(0,c.Lz)(n);return void 0!==a&&e.push({discountDetails:a,amount:(0,s.ox)(r)}),e}),[]);return{stableId:t,quantity:n,totalAmountAfterDiscounts:(0,s.ox)(r),totalAmountAfterLineDiscounts:(0,s.ox)(a),totalAmountBeforeReductions:(0,s.ox)(i),checkoutPriceAfterDiscounts:(0,s.ox)(o),checkoutPriceBeforeReductions:(0,s.ox)(d),allocations:m,unitPrice:p}}function U(e){switch(e.discount.__typename){case"CustomDiscount":return{title:e.discount.title,description:e.discount.description??void 0,amount:(0,s.ox)(e.lineAmount),allocations:B([...e.deliveryAllocations,...e.merchandiseAllocations]),discount:(0,c.xF)(e.discount)};case"CodeDiscount":case"AutomaticDiscount":return{title:e.discount.title,amount:(0,s.ox)(e.lineAmount),allocations:B([...e.deliveryAllocations,...e.merchandiseAllocations]),discount:(0,c.xF)(e.discount)};case"DiscountCodeTrigger":return{title:e.discount.code,discount:(0,c.xF)(e.discount)};default:return}}function B(e){return e.map((e=>({target:{index:e.index,amount:(0,s.ox)(e.amount),stableId:e.stableId,type:e.targetType}})))}function q(e){return H(e)??e.marketingConsent.some((e=>"PurchaseOrderEmailContactMethod"===e.__typename))}function N(e){return H(e)??e.marketingConsent.some((e=>"PurchaseOrderSMSContactMethod"===e.__typename))}function G(e){const t=e.marketingConsent.find((e=>"PurchaseOrderSMSContactMethod"===e.__typename));return t?.phoneNumber??""}function H(e){return"DecodedCustomerProfile"===e.customer?.__typename?e.customer.acceptsMarketing:"BusinessCustomerProfile"===e.customer?.__typename?e.customer.acceptsEmailMarketing:void 0}function V(e){const t=function(e){const t=e.map((e=>e.paymentMethod)).find((e=>"LocalPaymentMethod"===e.__typename));if(t)return{type:"local",name:t.name,displayName:t.displayName??"",additionalParameters:[],paymentMethodIdentifier:t.paymentMethodIdentifier??"",orderingIndex:Number.MAX_SAFE_INTEGER}}(e);return t?[t]:[]}}}]);