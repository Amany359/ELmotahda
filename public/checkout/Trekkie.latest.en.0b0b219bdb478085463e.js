"use strict";(self.webpackChunkcheckout_web=self.webpackChunkcheckout_web||[]).push([[5566],{60399:(e,t,a)=>{a.r(t),a.d(t,{default:()=>O}),a(86043);var i=a(62),o=a(26349),n=a(26959),r=a(4966),c=a(31191),s=(a(44074),a(90208)),u=a(54606),d=a(53798),l=a(66126);const p="checkout";class h extends Error{constructor(...e){super(...e),this.name="TrekkieError"}}class k{get trekkie(){return this.analyticsWindow?.trekkie}set trekkie(e){if(!this.analyticsWindow)throw new h("AnalyticsWindow is not set.");this.analyticsWindow.trekkie=e}get shopifyAnalytics(){return this.analyticsWindow.ShopifyAnalytics}set shopifyAnalytics(e){if(!this.analyticsWindow)throw new h("AnalyticsWindow is not set.");this.analyticsWindow.ShopifyAnalytics=e}constructor({shop:e,checkoutToken:t="",locale:a,analyticsConfig:i,sourceUrl:o,themeId:n,themeCityHash:r,monorail:c,s2s:h,monorailRegion:k},m){if(this.libraryLoaded=!1,this.analyticsWindow=void 0,this.trekkieLoadedCallback=void 0,this.trekkieLoadedCallback=m,this.analyticsWindow=window,this.trekkie=this.analyticsWindow.ShopifyAnalytics?.lib||this.analyticsWindow.trekkie||[],this.trekkie?.integrations)return this.libraryLoaded=!0,void this.trekkieLoadedCallback(this.analyticsWindow?.ShopifyAnalytics?.lib?.trekkie);const y=e=>(...t)=>(t.unshift(e),this.trekkie.push(t),this.trekkie);this.trekkie.track=y("track"),this.trekkie.page=y("page"),this.trekkie.ready=y("ready");const f=parseInt((0,u.ee)(e.id),10);this.trekkie.ready((()=>{this.libraryLoaded||(this.libraryLoaded=!0,this.shopifyAnalytics={...this.shopifyAnalytics,lib:this.trekkie},this.trekkieLoadedCallback(this.analyticsWindow?.ShopifyAnalytics?.lib?.trekkie))})),this.trekkie.load=e=>{this.trekkie.config=e;const t=document.getElementsByTagName("script")[0],a=document.createElement("script");a.type="text/javascript",a.onerror=function(){const e=document.createElement("script");e.type="text/javascript",e.onerror=function(){const e={schemaId:"trekkie_checkout_load_errors/1.1",payload:{appName:p,shopId:f,themeId:n,contextUrl:window.location.href,sourceUrl:o}};c.record(e)},e.async=!0,e.src=o,t.parentNode?.insertBefore(e,t)},a.async=!0,a.src=o,t.parentNode?.insertBefore(a,t)};const b={appName:p,development:(0,d.ao)()||!1,defaultAttributes:{shopId:f,isMerchantRequest:!!(0,s.Ri)("_ab")||null,themeId:n,themeCityHash:r,contentLanguage:a,currency:e.currencyCode,checkoutToken:t},isServerSideCookieWritingEnabled:!0,enabledBetaFlags:[l.Tt,l.jf]};k&&(b.monorailRegion=k),this.trekkie.load({Trekkie:b,...i,"Session Attribution":{},S2S:h})}page(e="",t={},a){this.trekkie?.page(e,t,a)}track(e,t,a){this.trekkie?.track(e,t,a)}}var m=a(37242),y=a(50966),f=a(98902),b=a(61697),g=a(95843),C=a(80768),v=a(43288),S=a(99064),A=a(18380),I=a(9463),P=a(66849),w=a(43195),_=a(14083);let x=function(e){return e.StartedOrder="Started Order",e.StartedOrderOncePerCheckout="Started Order Once Per Checkout",e.CompletedOrder="Completed Order",e.AddedPayment="Added Payment",e.CheckoutContactPageStarted="Checkout Contact Step Started",e.CheckoutContactInfoSubmitted="Checkout Contact Info Submitted",e.CheckoutAddressInfoSubmitted="Checkout Address Info Submitted",e.CheckoutShippingPageStarted="Checkout Shipping Step Started",e.CheckoutShippingInfoSubmitted="Checkout Shipping Info Submitted",e.CheckoutPaymentPageStarted="Checkout Payment Step Started",e.CheckoutOnePageView="Checkout One Page View",e}({});function E(e){switch(e){case"/":case"/information":return{title:"Checkout - Contact Information",page:"/checkout/contact_information"};case"/shipping":return{title:"Checkout - Shipping",page:"/checkout/shipping"};case"/payment":return{title:"Checkout - Payment",page:"/checkout/payment"};case"/review":return{title:"Checkout - Review",page:"/checkout/review"};case"/processing":return{title:"Checkout - Processing",page:"/checkout/processing"};case"/thank-you":return{title:"Checkout - Receipt",page:"/checkout/thank_you"};case"/stock-problems":return{title:"Checkout - Stock problems",page:"/checkout/stock_problems"};case"/error":return{title:"Checkout - Error",page:"/checkout/error"};case"/no-address-location":return{title:"Checkout - No Address Location",page:"/checkout/no_address_location"};case"/shoppay_login":return{title:"ShopPay - Login",page:"/shop.app/pay/login"};case"/shoppay":return{title:"ShopPay - Payment",page:"/shop.app/pay/payment"};default:return{title:null,page:null}}}function N(e,t){const a=e.read(t.current.fields.merchandiseLines).value,i=a?.lines?.map((e=>{const t=e.lineAllocations.reduce(((e,t)=>(t.allocations.filter((e=>"code"===e.discountDetails.discount.type)).forEach((t=>{t.amount.amount>e.amount&&(e.amount=t.amount.amount,e.code=t.discountDetails.title)})),e)),{code:void 0,amount:0});return{variantId:(0,u.Ne)(e.variantId),productId:(0,u.Ne)(e.productId),productGid:e.productId,category:e.productType,coupon:t.code,currency:e.itemPrice?.currencyCode,name:e.title,price:e.itemPrice?.amount,quantity:e.quantity,brand:e.vendor,variant:e.subtitle,sku:e.sku}}));return i}function T(){let e;return e=d.$z,`https://${e}/s/trekkie.storefront.min.js`}function O(){const e=(0,d.as)()?"trekkie-checkout-one-shop-app":"trekkie-checkout-one",t=(0,c.qu)(),a=(0,f.Fo)(),s=a.checkoutSessionIdentifier||a.sourceId,l=(0,m.g)(),p=(0,o.Y)(),h=(0,y.W$)();let O=void 0===t.theme?.id||null===t.theme?.id?void 0:parseInt(t.theme.id,10);O&&O>Number.MAX_SAFE_INTEGER&&(O=void 0);const L=t.theme?.cityhash,W=(0,b.a9)(),{email:R,phone:G,shippingAddress:M}=(0,g.C)(),K=(0,r.QN)(),F=(0,v.ET)(),{value:B}=(0,b.FC)(),H=(0,n.K)("api-client-id"),D=(0,n.K)("api-client-id"),{currentPage:U}=(0,S.Wm)(),j=U&&["onePage"].includes(U.id),q=(0,A.NE)(),z=(0,i.Kr)((()=>{if((0,d.as)()||q)return{};const e=t.analyticsAccount?{"Google Analytics":{trackingId:t.analyticsAccount,domain:"auto",siteSpeedSampleRate:"10",enhancedEcommerce:t.enhancedEcommerceEnabled,doubleClick:!0,includeSearch:!0}}:{};return(t.trackingPixels||[]).reduce(((e,{pixelType:t,pixelId:a,pixelConfig:i})=>{const o=function(e){switch(e){case"PINTEREST":return"Pinterest Pixel";case"SNAPCHAT":return"Snap Pixel";case"TIK_TOK":return"TikTok Pixel";case"FACEBOOK":case"GOOGLE_TAG_MANAGER":return;default:(0,C.xb)(e)}}(t);switch(t){case"GOOGLE_TAG_MANAGER":{const t=i||{},o={conversionId:a,eventLabels:t?.gtag_events||[],targetCountry:t?.target_country||"US",ignoreReferrer:!0};e["Google Gtag Pixel"]=o}break;case"FACEBOOK":e["Facebook Pixel"]||(e["Facebook Pixel"]={pixelIds:[],agent:"plshopify1.2"}),e["Facebook Pixel"].pixelIds.push(a);break;case"PINTEREST":e["Pinterest Pixel"]={pixelId:a};break;case"SNAPCHAT":e["Snap Pixel"]={pixelId:a};break;case"TIK_TOK":e["TikTok Pixel"]={pixelId:a};break;default:if(!o)return h.notify(new _.W(`Shop has unknown pixelType "${t}".`)),e;e[o]={pixelId:a}}return e}),e)}),[t.trackingPixels,t.analyticsAccount,t.enhancedEcommerceEnabled,h,q]),V=(0,w.QB)(),$=(0,i.hb)((e=>{null!=e&&V.value.defaultAttributes!==e.defaultAttributes?V.setValue({defaultAttributes:e.defaultAttributes}):null==e&&h.notify(new _.W("Trekkie is not available"))}),[h,V]),Q=(0,i.Kr)((()=>{const a=null===L?void 0:L,i=K.read(W.current.fields.buyerIdentity).value,o={facebookAppPixelId:t.facebookAppPixelId,facebookCapiEnabled:t.facebookCapiEnabled,source:e,customerId:(0,u.Ne)(i?.customerProfile?.id),cartApiClientId:H,apiClientId:D},n={shop:t,checkoutToken:s,locale:p,analyticsConfig:z,sourceUrl:T(),themeId:O,themeCityHash:a,monorail:l,monorailRegion:"shop_domain",s2s:o};return q?null:function(e,t){return new k(e,t)}(n,$)}),[t,s,p,z,O,L,l,$,W,K,H,D,e,q]),X=(0,i.hb)((e=>{const{title:t,page:a}=E(e);t&&a&&Q?.page(t,{path:a})}),[Q]),Y=(0,i.hb)((e=>{const{title:t,page:a}=E(e);if(!t||!a)return;const i={name:t,path:a};Q?.track(x.CheckoutOnePageView,i)}),[Q]),J=(0,i.Kr)((()=>{let e={amount:void 0,currencyCode:void 0};return F&&"filled"===B?.status&&B.lines.forEach((t=>{if("available"===t.status){const a=t.selectedDeliveryMethodHandle;if(a){const i=t.methods.filter((e=>e.handle===a&&void 0!==e.cost));e=i.reduce(((e,t)=>{const a=void 0===e.amount?0:e.amount;return e.amount=a+t.cost.amount,e.currencyCode=t.cost.currencyCode,e}),e)}}})),e}),[B,F]),Z=(0,i.hb)((()=>{const e=K.read(W.current.fields.subtotal).value,t={step:1,products:N(K,W),currency:e?.currencyCode,revenue:e?.amount};Q?.track(x.StartedOrder,t)}),[Q,K,W]),ee=(0,i.hb)((()=>{const e=K.read(W.current.fields.subtotal).value,t={step:1,products:N(K,W),currency:e?.currencyCode,revenue:e?.amount};Q?.track(x.StartedOrderOncePerCheckout,t)}),[Q,K,W]),te=(0,P.H)(),ae=(0,i.hb)((()=>{if(!F||te)return;const e=N(K,W),a=F.purchaseOrder,i=(0,u.Ne)(F.orderIdentity.id),o=i?.toString(),n=a.billingAddress,r=K.read(W.current.fields.buyerIdentity).value,c=r?.customerProfile;let s=c?.firstName,d=c?.lastName;d||(s=n?.firstName,d=n?.lastName);const l=K.read(W.current.fields.total).value,p=K.read(W.current.fields.subtotal).value,h=K.read(W.current.fields.contactInfo).value,k=K.read(W.current.fields.discountLines).value,m=k?.lines.filter((e=>"code"===e.discount.type)).map((e=>e.discount.title))||[],y=F.analytics?.checkoutCompletedEventId||void 0;Q?.track(x.CompletedOrder,{customerEventData:{pixelID:t.facebookAppPixelId??void 0,customer:{firstName:s,lastName:d,emailAddress:c?.email??h?.email,phoneNumber:c?.phone??h?.phone},address:{city:n?.city,province:n?.zoneCode,country:n?.countryCode,zip:n?.postalCode}},orderId:i,orderName:o,products:e,total:l?.amount??0,currency:l?.currencyCode,revenue:p?.amount??0,coupon:m[0],tax:a.totalTaxes?.amount??0,shipping:J.amount??0},y)}),[F,te,K,W,Q,t.facebookAppPixelId,J.amount]),ie=(0,i.hb)((()=>{const e=K.read(W.current.fields.runningTotal).value,t={currency:e?.currencyCode,total:e?.amount};Q?.track(x.AddedPayment,t)}),[Q,K,W]),oe=(0,i.hb)((()=>{const{title:e,page:t}=E("/information"),a={name:e,path:t};Q?.track(x.CheckoutContactPageStarted,a)}),[Q]),ne=(0,i.hb)((()=>{const e={email:K.read(R).value,phone:K.read(G).value};Q?.track(x.CheckoutContactInfoSubmitted,e)}),[Q,K,R,G]),re=(0,i.hb)((()=>{const e=K.read(M).value,t={city:e?.city,country:e?.countryCode,phone:e?.phone,province:e?.zoneCode,postalCode:e?.postalCode,firstName:e?.firstName,lastName:e?.lastName,address1:e?.address1,address2:e?.address2};Q?.track(x.CheckoutAddressInfoSubmitted,t)}),[Q,K,M]),ce=(0,i.hb)((()=>{const{title:e,page:t}=E("/shipping"),a={name:e,path:t};Q?.track(x.CheckoutShippingPageStarted,a)}),[Q]),se=(0,i.hb)((()=>{const e=K.read(W.current.fields.runningTotal).value,t={total:e?.amount,currency:e?.currencyCode};Q?.track(x.CheckoutShippingInfoSubmitted,t)}),[Q,K,W]),ue=(0,i.hb)((()=>{const{title:e,page:t}=E("/payment"),a={name:e,path:t};Q?.track(x.CheckoutPaymentPageStarted,a)}),[Q]);return(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&"page_view"===e.type&&X(e.url)}),[V,X])),(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&"initiate_checkout"===e.type&&Z()}),[V,Z])),(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&"initiate_checkout_once_per_checkout"===e.type&&ee()}),[V,ee])),(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&"complete_checkout"===e.type&&ae()}),[V,ae])),(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&"add_payment_info"===e.type&&ie()}),[V,ie])),(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&"one_page_checkout_page_view"===e.type&&Y(e.url)}),[V,Y])),(0,I.ML)((0,i.hb)((e=>{V.value.defaultAttributes&&("section_interaction"===e.type&&j&&("contact"===e.section?oe():"payment"===e.section&&(se(),ue())),"section_complete"===e.type&&("contact"===e.section?ne():"deliveryAddress"===e.section&&re()),"shipping_methods_filled"===e.type&&j&&ce(),"page_submit"!==e.type||"shipping"!==e.page||j||se())}),[V.value.defaultAttributes,j,oe,se,ue,ne,re,ce])),null}}}]);